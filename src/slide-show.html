<!-- modified version of cat-alogue-iron -->
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/neon-animation/neon-animation.html">

<dom-module id='slide-show'>

	<style>
		:host {
			display: block;
			height: 380px;
		}
		.pic {
			max-height: 375px;
			max-width: 100%;
		}
		neon-animatable {
			height: 375px;		
		}
		.flex-horizontal {
		    @apply(--layout-horizontal);
		}
		.flex-child {
		    @apply(--layout-flex);
		}
		.small {
			/*color: red;*/
			font-size:10px;
		}

	</style>

	<template>

		<div class='layout vertical' style="text-align: center">
			<!-- OPTION: Ctrls for manual navigation  -->
			<!-- <div class='controls layout horizontal justified'>
				<button on-tap='_goPrev'>Previous</button>
				<input type='text' value='{{selected::input}}'>
				<button on-tap='_goNext'>Next</button>
			</div> -->
		
			<!-- Animation scene -->
	    	<!-- class="flex"  -->
		    <neon-animated-pages 
		    	id="pagesId" 
		    	selected="{{selected}}" 
		    	entry-animation="[[entryAnimation]]" 
		    	exit-animation="[[exitAnimation]]">

				<template is='dom-repeat' items='{{imas}}' as='img'>
			        <neon-animatable>
						<div class="flex-horizontal">
							<div class="flex-child">[[img.title]]</div>
							<span class="small">[[img.index]]</span>
						</div>
						<img src='{{img.url}}' alt='{{img.alias}}' class='pic' on-tap="tapAction"/>
			        </neon-animatable>
			    </template>

			</neon-animated-pages>
			
		</div>	

	</template>

	<script>
	
		Polymer({
			is: 'slide-show',

			properties:{

				selected:{
					type: Number,
					value: 0,
					notify: true
				},

				imas : {
					type: Array,
					value : [ 
					],
					observer: 'initSlider'
				},

				entryAnimation: '',
				exitAnimation: '',
			},
			
			listeners:{	 
				'pagesId.track': 'handleTrack'
			},

			tapAction: function(e, t) { console.log("image tap action", this.selected);
		        // this.page = 'spotter';
			}, 	

			initSlider: function(imas, oldimas) {  // console.log("init slider:", imas);
				this.$.pagesId.selectIndex(0); // this.selected = 0;
			},

			handleTrack: function(e) {  
				switch(e.detail.state) { 
					case 'start':
						this.xstart = e.detail.x; 
						this.tstart = e.timeStamp;
						break;
					case 'track': // onsole.log('Tracking in progress... ' + e.detail.x + ', ' + e.detail.y);
						break;
					case 'end':
						this.triggerPage(e.detail.x - this.xstart, e.timeStamp - this.tstart);
						break;
				}
			},

			triggerPage: function(dx) { // , dy) { // console.log("SwipeLog dx,dt:",dx,dy);
				// 
			    if      (dx < -30) {
			      	this._goNext(); 
			    } else if (dx > 30) {
			      	this._goPrev();
			    } 
			},

			_goPrev: function() {
				this.entryAnimation = 'slide-from-left-animation';
				this.exitAnimation  = 'slide-right-animation';
				this.$.pagesId.selectPrevious();
			},

			_goNext: function() {
				this.entryAnimation = 'slide-from-right-animation';
				this.exitAnimation  = 'slide-left-animation';
				this.$.pagesId.selectNext();
			}

		});

	</script>
</dom-module>